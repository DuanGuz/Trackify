{% extends "core/base.html" %}
{% load static %}

{% block content %}
<div class="row">
  <!-- Saludo -->
  <div class="col-12">
    <div class="d-flex align-items-center mb-3">
      <h5 class="mb-0">Hola, {{ user.get_full_name|default:user.username }} ðŸ‘‹</h5>
      <span class="text-muted ml-3">Bienvenido a Trackify</span>
    </div>
  </div>

  {# KPIs / Contadores (opcionales, si los pasas desde la vista) #}
  {% if request.user.is_superuser or request.user.rol.nombre == "Recursos humanos" %}
    <div class="col-12 col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-body d-flex align-items-center">
          <i class="fe fe-users mr-3"></i>
          <div>
            <div class="small text-muted">Personal</div>
            <div class="h5 mb-0">{{ usuarios_count|default:"â€”" }}</div>
          </div>
          <a href="{% url 'user_list' %}" class="ml-auto btn btn-sm btn-outline-primary">Ver</a>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-4">
      <div class="card shadow-sm mb-3">
        <div class="card-body d-flex align-items-center">
          <i class="fe fe-briefcase mr-3"></i>
          <div>
            <div class="small text-muted">Departamentos</div>
            <div class="h5 mb-0">{{ departamentos_count|default:"â€”" }}</div>
          </div>
          <a href="{% url 'departamento_list' %}" class="ml-auto btn btn-sm btn-outline-primary">Ver</a>
        </div>
      </div>
    </div>
  {% endif %}

  <div class="col-12 col-md-4">
    <div class="card shadow-sm mb-3">
      <div class="card-body d-flex align-items-center">
        <i class="fe fe-check-square mr-3"></i>
        <div>
          <div class="small text-muted">Tareas pendientes</div>
          <div class="h5 mb-0">{{ tareas_pendientes_count|default:"â€”" }}</div>
        </div>
        <a href="{% url 'perfil' %}" class="ml-auto btn btn-sm btn-outline-primary">Mi perfil</a>
      </div>
    </div>
  </div>

  <!-- Accesos rÃ¡pidos (role-aware) -->
  <div class="col-12">
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <div class="d-flex align-items-center mb-2">
          <h6 class="mb-0">Accesos rÃ¡pidos</h6>
        </div>
        <div class="d-flex flex-wrap">
          {% if request.user.is_superuser or request.user.rol.nombre == "Recursos humanos" %}
            <a href="{% url 'user_create' %}" class="btn btn-light mr-2 mb-2">
              <i class="fe fe-user-plus mr-1"></i> Crear usuario
            </a>
            <a href="{% url 'user_list' %}" class="btn btn-light mr-2 mb-2">
              <i class="fe fe-users mr-1"></i> Ver personal
            </a>
            <a href="{% url 'departamento_create' %}" class="btn btn-light mr-2 mb-2">
              <i class="fe fe-briefcase mr-1"></i> Crear departamento
            </a>
            <a href="{% url 'departamento_list' %}" class="btn btn-light mr-2 mb-2">
              <i class="fe fe-grid mr-1"></i> Ver departamentos
            </a>
          {% endif %}
          <a href="{% url 'perfil' %}" class="btn btn-light mr-2 mb-2">
            <i class="fe fe-user mr-1"></i> Mi perfil
          </a>
          <a href="{% url 'perfil_password' %}" class="btn btn-light mr-2 mb-2">
            <i class="fe fe-lock mr-1"></i> Cambiar contraseÃ±a
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Mis tareas (tabla simple; pÃ¡sale 'mis_tareas' desde la vista) -->
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table mb-0">
            <thead class="thead-light">
              <tr>
                <th>Tarea</th>
                <th>Departamento</th>
                <th>Estado</th>
                <th>Fecha lÃ­mite</th>
                <th class="text-right">Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for t in mis_tareas %}
              <tr>
                <td class="align-middle">{{ t.titulo }}</td>
                <td class="align-middle text-muted">{{ t.departamento.nombre }}</td>
                <td class="align-middle">
                  {% if t.estado == "pendiente" %}
                    <span class="badge badge-warning text-dark">Pendiente</span>
                  {% elif t.estado == "en_progreso" %}
                    <span class="badge badge-info">En progreso</span>
                  {% elif t.estado == "completada" %}
                    <span class="badge badge-success">Completada</span>
                  {% else %}
                    <span class="badge badge-secondary">{{ t.estado }}</span>
                  {% endif %}
                </td>
                <td class="align-middle">{{ t.fecha_limite|date:"d/m/Y" }}</td>
                <td class="align-middle text-right">
                  <a href="{% url 'tarea_detail' t.id %}" class="btn btn-sm btn-outline-primary">
                    <i class="fe fe-eye"></i> Ver
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="5" class="text-center text-muted py-4">
                  No tienes tareas asignadas por ahora.
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}
